<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate mixing proportions and origin probabilities from one or several mixtures — infer_mixture • rubias</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate mixing proportions and origin probabilities from one or several mixtures — infer_mixture"><meta name="description" content="Takes a mixture and reference dataframe of two-column genetic data, and a
desired method of estimation for the population mixture proportions (MCMC, PB, BR).
Returns the output of the chosen estimation method"><meta property="og:description" content="Takes a mixture and reference dataframe of two-column genetic data, and a
desired method of estimation for the population mixture proportions (MCMC, PB, BR).
Returns the output of the chosen estimation method"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rubias</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/rubias-fully-bayesian.html">Using the Fully Bayesian Model in rubias</a></li>
    <li><a class="dropdown-item" href="../articles/rubias-overview.html">An Overview of rubias Usage</a></li>
    <li><a class="dropdown-item" href="../articles/rubias-underlying-data-structures.html">An Explanation of the Underlying Data Structures in rubias</a></li>
    <li><a class="dropdown-item" href="../articles/uncertainty-on-total-catch.html">Summarizing Uncertainty on Stock-Specific Total Catch</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eriqande/rubias/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate mixing proportions and origin probabilities from one or several mixtures</h1>
      <small class="dont-index">Source: <a href="https://github.com/eriqande/rubias/blob/HEAD/R/infer_mixture.R" class="external-link"><code>R/infer_mixture.R</code></a></small>
      <div class="d-none name"><code>infer_mixture.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Takes a mixture and reference dataframe of two-column genetic data, and a
desired method of estimation for the population mixture proportions (MCMC, PB, BR).
Returns the output of the chosen estimation method</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">infer_mixture</span><span class="op">(</span></span>
<span>  <span class="va">reference</span>,</span>
<span>  <span class="va">mixture</span>,</span>
<span>  <span class="va">gen_start_col</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"MCMC"</span>,</span>
<span>  alle_freq_prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>const_scaled <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  pi_prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pi_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reps <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  burn_in <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  pb_iter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  prelim_reps <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prelim_burn_in <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_int_Pi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  sample_theta <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pi_prior_sum <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  total_catch_tib <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variable_prob_is_catch <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-reference">reference<a class="anchor" aria-label="anchor" href="#arg-reference"></a></dt>
<dd><p>a dataframe of two-column genetic format data, proceeded by "repunit", "collection",
and "indiv" columns. Does not need "sample_type" column, and will be overwritten if provided</p></dd>


<dt id="arg-mixture">mixture<a class="anchor" aria-label="anchor" href="#arg-mixture"></a></dt>
<dd><p>a dataframe of two-column genetic format data. Must have the same structure as
<code>reference</code> dataframe, but "collection" and "repunit" columns are ignored.
Does not need "sample_type" column, and will be overwritten if provided</p></dd>


<dt id="arg-gen-start-col">gen_start_col<a class="anchor" aria-label="anchor" href="#arg-gen-start-col"></a></dt>
<dd><p>the first column of genetic data in both data frames</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>a choice between "MCMC", "PB", "BR" methods for estimating mixture proportions</p></dd>


<dt id="arg-alle-freq-prior">alle_freq_prior<a class="anchor" aria-label="anchor" href="#arg-alle-freq-prior"></a></dt>
<dd><p>a one-element named list specifying the prior to be used when
generating Dirichlet parameters for genotype likelihood calculations. Valid methods include
<code>"const"</code>, <code>"scaled_const"</code>, and <code>"empirical"</code>. See <code><a href="list_diploid_params.html">?list_diploid_params</a></code>
for method details.</p></dd>


<dt id="arg-pi-prior">pi_prior<a class="anchor" aria-label="anchor" href="#arg-pi-prior"></a></dt>
<dd><p>The prior to be added to the collection allocations, in order to generate pseudo-count
Dirichlet parameters for the simulation of new pi vectors in MCMC. Default value of NA leads to the
calculation of a symmetrical prior based on <code>pi_prior_sum</code>. To provide other values to
certain collections, you can pass in a data frame with two columns, "collection"
listing the relevant collection, and "pi_param" listing the desired prior for that collection.
Specific priors may be listed for as few as one collection. The special collection name "DEFAULT_PI"
is used to set the prior for all collections not explicitly listed; if no "DEFAULT_PI" is given, it is
taken to be 1/(# collections).</p></dd>


<dt id="arg-pi-init">pi_init<a class="anchor" aria-label="anchor" href="#arg-pi-init"></a></dt>
<dd><p>The initial value to use for the mixing proportion of collections.  This lets
the user start the chain from a specific value of the mixing proportion vector.  If pi_init is NULL
(the default) then the mixing proportions are all initialized to be equal.  Otherwise, you pass
in a data frame with one column named "collection" and the other named "pi_init".  Every value in the
pi_init column must be strictly positive (&gt; 0), and a value must be given for every collection.  If they sum
to more than one the values will be normalized to sum to one.</p></dd>


<dt id="arg-reps">reps<a class="anchor" aria-label="anchor" href="#arg-reps"></a></dt>
<dd><p>the number of iterations to be performed in MCMC</p></dd>


<dt id="arg-burn-in">burn_in<a class="anchor" aria-label="anchor" href="#arg-burn-in"></a></dt>
<dd><p>how many reps to discard in the beginning of MCMC when doing the mean calculation.
They will still be returned in the traces if desired.</p></dd>


<dt id="arg-pb-iter">pb_iter<a class="anchor" aria-label="anchor" href="#arg-pb-iter"></a></dt>
<dd><p>how many bootstrapped data sets to do for bootstrap correction using method PB.  Default
is 100.</p></dd>


<dt id="arg-prelim-reps">prelim_reps<a class="anchor" aria-label="anchor" href="#arg-prelim-reps"></a></dt>
<dd><p>for method "BR", the number of reps of conditional MCMC (as in method "MCMC")
to perform prior to MCMC with baseline resampling. The posterior mean of mixing proportions
from this conditional MCMC is then used as <code>pi_init</code> in the baseline resampling MCMC.</p></dd>


<dt id="arg-prelim-burn-in">prelim_burn_in<a class="anchor" aria-label="anchor" href="#arg-prelim-burn-in"></a></dt>
<dd><p>for method "BR", this sets the number of sweeps out of <code>prelim_reps</code>
that should be discarded as burn in when preparing the posterior means of the mixing
proportions to be set as <code>pi_init</code> in the baseline resampling MCMC.</p></dd>


<dt id="arg-sample-int-pi">sample_int_Pi<a class="anchor" aria-label="anchor" href="#arg-sample-int-pi"></a></dt>
<dd><p>how many iterations between storing the mixing proportions trace. Default is 1.
Can't be 0. Can't be so large that fewer than 10 samples are taken from the burn in and the sweeps.</p></dd>


<dt id="arg-sample-theta">sample_theta<a class="anchor" aria-label="anchor" href="#arg-sample-theta"></a></dt>
<dd><p>for method "BR", whether or not the function should store the posterior mean
of the updated allele frequences. Default is TRUE</p></dd>


<dt id="arg-pi-prior-sum">pi_prior_sum<a class="anchor" aria-label="anchor" href="#arg-pi-prior-sum"></a></dt>
<dd><p>For <code>pi_prior = NA</code>, the prior on the mixing proportions is set
as a Dirichlet vector of length C, with each element being W/C, where W is the pi_prior_sum
and C is the number of collections. By default this is 1.  If it is made much smaller than 1, things
could start to mix more poorly.</p></dd>


<dt id="arg-total-catch-tib">total_catch_tib<a class="anchor" aria-label="anchor" href="#arg-total-catch-tib"></a></dt>
<dd><p>A tibble with two columns: `collection` and `tot_catch`. The entries to `collection`
must correspond to different fisheries or mixture collections as listed in the `collections` column in
`mixture`.  The `tot_catch` must be a list column which contains an estimate of the total
catch from the fishery.  That could be a single number, or it could be a sample from a posterior
distribution of the total catch.  Providing a value for this parameter will make the function
return a sample from the posterior for stock-specific total catch. Note that if you use this option
then every single mixture collection in `mixture` must be represented in `total_catch_tib`.</p></dd>


<dt id="arg-variable-prob-is-catch">variable_prob_is_catch<a class="anchor" aria-label="anchor" href="#arg-variable-prob-is-catch"></a></dt>
<dd><p>a logical indicating whether to use the `catch_is_prob` column to simulate
for each fish whether or not it should be considered part of the catch.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Tidy data frames in a list with the following components:
mixing_proportions: the estimated mixing proportions of the different collections.
indiv_posteriors: the posterior probs of fish being from each of the collections.
mix_prop_traces: the traces of the mixing proportions.  Useful for computing credible intervals.
bootstrapped_proportions: If using method "PB" this returns the bootstrap corrected
reporting unit proportions.  If `total_catch_tib` is not NULL, then you will also found
three other components in the output list: `stock_specific_total_catch_traces`,
`posterior_predictive_remaining_catch_traces` and `allocation_count_traces`.  These
give samples from the posterior distribution of total catch.  Note that
`stock_specific_total_catch_traces` is the sum of `posterior_predictive_remaining_catch_traces`
and `allocation_count_traces`.  All three are returned because it can be instructive
to be able to decompose the `stock_specific_total_catch_traces` into its two
constituents.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>"MCMC" estimates mixing proportions and individual posterior
probabilities of assignment through Markov-chain Monte Carlo
conditional on the reference allele frequencies,
while "PB" does the same with a parametric bootstrapping correction,
and "BR" runs MCMC sweeps while simulating reference allele frequencies
using the genotypes of mixture individuals and allocations from the previous sweep.
All methods default to a uniform 1/(# collections or RUs) prior for the mixing proportions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mcmc</span> <span class="op">&lt;-</span> <span class="fu">infer_mixture</span><span class="op">(</span>reference <span class="op">=</span> <span class="va">small_chinook_ref</span>,</span></span>
<span class="r-in"><span>                      mixture <span class="op">=</span> <span class="va">small_chinook_mix</span>,</span></span>
<span class="r-in"><span>                      gen_start_col <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>                      method <span class="op">=</span> <span class="st">"MCMC"</span>,</span></span>
<span class="r-in"><span>                      reps  <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Collating data; compiling reference allele frequencies, etc.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.11 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing reference locus specific means and variances for computing mixture z-scores</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.01 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Working on mixture collection: rec3 with 29 individuals</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   calculating log-likelihoods of the mixture individuals.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   performing 200 total sweeps, 100 of which are burn-in and will not be used in computing averages in method "MCMC"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   tidying output into a tibble.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.01 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Working on mixture collection: rec1 with 36 individuals</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   calculating log-likelihoods of the mixture individuals.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   performing 200 total sweeps, 100 of which are burn-in and will not be used in computing averages in method "MCMC"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   tidying output into a tibble.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.01 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Working on mixture collection: rec2 with 35 individuals</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   calculating log-likelihoods of the mixture individuals.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   performing 200 total sweeps, 100 of which are burn-in and will not be used in computing averages in method "MCMC"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.00 seconds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   tidying output into a tibble.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    time: 0.01 seconds</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric C. Anderson, Ben Moran.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

